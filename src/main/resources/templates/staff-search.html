<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common :: meta_header('社員情報検索',~{::link},~{::script})">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>社員情報検索 | TestApplication</title>
    <!--/* -->
    <link rel="icon" href="../static/images/logo.png">
    <script src="../static/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/style.css">
    <script type="text/javascript" src="../static/js/jquery-3.6.0.min.js"></script>
    <script>
        $(function (){
            $.ajaxSetup({cache:false});
            $('header.header').load('./common.html .header .header__inner');
        });
        $(function (){
            $.ajaxSetup({cache:false});
            $('div.left-nav').load('./common.html .left-nav__menu');
        });
    </script>
    <script type="module">
        import { initHeader } from "../static/js/header_template.js";
        let timerId = setInterval(function(){
            if (document.querySelector('.user-id')) {
                initHeader();
                clearInterval(timerId);
            }
        },100);
    </script>
    <!-- */-->
    <script th:inline="javascript" type="module">
        window.addEventListener('load', function(){
            const staffs = /*[[${staffs}]]*/ null;
            if (staffs) {
                const count = /*[[${count}]]*/ 0;
                const limitSize = /*[[${limitSize}]]*/ 0;
                const page = /*[[${page}]]*/ 0;
                document.querySelectorAll('.page-item.num').forEach(function (e) {
                    e.remove();
                })
                const maxPage = Math.ceil(count / limitSize);
                const pagenationUl = document.querySelector('ul.pagination');
                const nextLi = document.querySelector('ul.pagination .next');
                const pagenationWidthOneSide = 2;
                let pagenationStart = page - pagenationWidthOneSide;
                if (pagenationStart <= 0) {
                    pagenationStart = 1;
                }
                let pagenationEnd = page + pagenationWidthOneSide;
                if (pagenationEnd > maxPage) {
                    pagenationEnd = maxPage;
                }
                for (let i = pagenationStart; i < pagenationEnd + 1; i++) {
                    let newPageNumberElement = document.createElement('li');
                    newPageNumberElement.classList.add('page-item','num');
                    if (i === page) {
                        newPageNumberElement.classList.add('active');
                    }
                    let newLinkElement = document.createElement('a');
                    newLinkElement.classList.add('page-link');
                    let newUrl = new URL(location.href);
                    newUrl.searchParams.set('page',i);
                    if (i !== page) {
                        newLinkElement.setAttribute('href',newUrl);
                    }
                    newLinkElement.innerHTML = i;
                    newPageNumberElement.appendChild(newLinkElement);
                    pagenationUl.insertBefore(newPageNumberElement,nextLi);
                }
                let previousElement = document.querySelector('.page-item.previous');
                if (page === 1) {
                    previousElement.classList.add('disabled');
                } else {
                    let newUrl = new URL(location.href);
                    newUrl.searchParams.set('page',page - 1);
                    document.querySelector('.page-item.previous .page-link').setAttribute('href',newUrl);
                }
                let nextElement = document.querySelector('.page-item.next');
                if (page === maxPage) {
                    document.querySelector('.page-item.next').classList.add('disabled');
                } else {
                    let newUrl = new URL(location.href);
                    newUrl.searchParams.set('page',page + 1);
                    document.querySelector('.page-item.next .page-link').setAttribute('href',newUrl);
                }

                document.querySelector('#maxPage').value = limitSize;
            }
        });
    </script>
    <script th:inline="javascript" type="module">
        window.addEventListener('load', function(){
            let select = document.querySelector('#maxPage');
            select.addEventListener('change', function () {
                let newUrlPrevious = new URL(document.querySelector('.page-item.previous .page-link').getAttribute('href'));
                newUrlPrevious.searchParams.set('limitSize', select.value);
                document.querySelector('.page-item.previous .page-link').setAttribute('href', newUrlPrevious);
                
                let nums = document.querySelectorAll('.page-item.num .page-link');
                nums.forEach(num => {
                    let href = num.getAttribute('href');
                    if (href) {
                        let newUrlNum = new URL(num.getAttribute('href'));
                        newUrlNum.searchParams.set('limitSize', select.value);
                        num.setAttribute('href', newUrlNum);
                    }
                })
                
                let newUrlNext = new URL(document.querySelector('.page-item.next .page-link').getAttribute('href'));
                newUrlNext.searchParams.set('limitSize', select.value);
                document.querySelector('.page-item.next .page-link').setAttribute('href', newUrlNext);
            })
        });
    </script>
</head>
<body>
    <!--/* --><header class="header"><div class="header__inner"></div></header><!-- */-->
    <!--/*/<header th:replace="common :: header"></header>/*/-->
    <nav class="breadcrumb-wrap border" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="top.html" th:href="@{/top}">トップ</a></li>
            <li class="breadcrumb-item"><a href="staff.html" th:href="@{/staff}">社員情報</a></li>
            <li class="breadcrumb-item active" aria-current="page">検索</li>
        </ol>
    </nav>
    <div class="content">
        <!--/* --><div class="left-nav border-start border-bottom"></div><!-- */-->
        <!--/*/<div th:replace="common :: left-nav"></div>/*/-->
        <div class="row main">
            <div class="center col-12 border-start border-end border-bottom">
                <div class="page-header bg-light shadow-sm border tytle">社員情報検索</div>
                <div class="staff-search">
                    <div class="staff-search__result"  th:if="${staffs} != null">
                        <div class="staff-search__result__count" th:text="${limitSize} * (${page} - 1) + 1 + ' 件目 / ' + ${count} + ' 件'">25 件目 / 135 件</div>
                        <div class="staff-search__result__list">
                            <table class="table table-striped staff-search__result__list__table">
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">ユーザーID</th>
                                        <th scope="col">氏名</th>
                                        <th scope="col">部署</th>
                                        <th scope="col">性別</th>
                                        <th scope="col">生年月日</th>
                                        <th scope="col">血液型</th>
                                        <th scope="col">都道府県</th>
                                        <th scope="col">市町村</th>
                                        <th scope="col">電話番号(私用)</th>
                                        <th scope="col">Eメールアドレス(私用)</th>
                                        <th scope="col">電話番号(社内)</th>
                                        <th scope="col">Eメールアドレス(社内)</th>
                                        <th scope="col">有効開始日</th>
                                        <th scope="col">有効終了日</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="staff : ${staffs}">
                                        <td th:text="${staff.userId}">STF0000002</td>
                                        <td th:text="${staff.familyName} + ' ' + ${staff.firstName}">楠 圭二</td>
                                        <td th:text="${staff.departmentName}">D30001</td>
                                        <td th:text="${staff.genderName}">0001</td>
                                        <td th:text="${staff.birthdate}">1873-11-09</td>
                                        <td th:text="${staff.bloodTypeName}">0001</td>
                                        <td th:text="${staff.addressPrefectureName}">0006</td>
                                        <td th:text="${staff.addressMunicipality}">南陽市長岡</td>
                                        <td th:text="${staff.privateTelNo}">07727301437</td>
                                        <td th:text="${staff.privateEmail}">user2@private.com</td>
                                        <td th:text="${staff.workplaceTelNo}">06041084375</td>
                                        <td th:text="${staff.workplaceEmail}">user2@sales.com</td>
                                        <td th:text="${staff.expirationStart}">2022-06-01</td>
                                        <td th:text="${staff.expirationEnd}">2022-09-01</td>
                                    </tr>
                                    <!--/* -->
                                    <tr th:each="staff : ${staffs}">
                                        <td>STF0000003</td>
                                        <td>沼田 花恋</td>
                                        <td>D20001</td>
                                        <td>0002</td>
                                        <td>1980-05-02</td>
                                        <td>0002</td>
                                        <td>0029</td>
                                        <td>奈良市生琉里町4-11-18生琉里町シティ205</td>
                                        <td>03758596249</td>
                                        <td>user3@private.com</td>
                                        <td>04850116018</td>
                                        <td>user3@sales.com</td>
                                        <td>2022-06-01</td>
                                        <td>2022-09-01</td>
                                    </tr>
                                    <!-- */-->
                                </tbody>
                            </table>
                        </div>
                        <div class="staff-search__result__lower">
                            <div class="staff-search__result__lower__select-max-page">
                                <div>表示行数</div>
                                <select id="maxPage">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                            <nav aria-label="Page navigation">
                                <ul class="pagination pagination-sm">
                                  <li class="page-item previous">
                                    <a class="page-link" href="#" aria-label="Previous">
                                      <span aria-hidden="true">&laquo;</span>
                                    </a>
                                  </li>
                                  <li class="page-item num"><a class="page-link" href="#">1</a></li>
                                  <li class="page-item num active"><a class="page-link" href="#">2</a></li>
                                  <li class="page-item num"><a class="page-link" href="#">3</a></li>
                                  <li class="page-item next">
                                    <a class="page-link" href="#" aria-label="Next">
                                      <span aria-hidden="true">&raquo;</span>
                                    </a>
                                  </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>